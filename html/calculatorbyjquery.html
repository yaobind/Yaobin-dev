<html>
        <head>
            <script
                src="https://code.jquery.com/jquery-3.2.1.js"
                integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
                crossorigin="anonymous">
            </script>
    
            <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js"></script>
    
            <style>
                .wrap {
                    position: fixed;
                    left: 20%;
                    top: 20%;
                    width: 40%;
                    height: 40%;
                }

                #calc-label {
                    text-align: center;
                    width: 100%;
                    background-color: beige;
                }

                .calculator {
                    position: relative;
                    width: 100%;
                    height: 100%;
                    border: 1px solid gray;
                    background-color: lightcyan;
                    display: flex;
                    flex-direction: column;
                }

                .result {
                    flex: 0 0 30%;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    margin: 5px;
                    border: 1px solid gray;
                    background-color: white;
                }

                .result-value {
                    flex: auto;
                    text-align: right;
                    font-size: 30px;
                    padding-right: 10px; 
                }

                .buttons {
                    flex: auto;
                    display: flex;
                }

                .digits {
                    flex: auto;
                    display:flex;
                    /* border: 1px solid gray; */
                    /* margin: 5px; */
                    flex-flow: row wrap;
                    justify-content: center;
                }

                .digits button {
                    flex: 0 1 30%;
                    margin: 5px; 
                }

                .operators {
                    flex: auto;
                    display:flex;
                    /* border: 1px solid gray; */
                    /* margin: 5px; */
                    flex-flow: column nowrap;
                    justify-content: space-between;
                }

                .operators button {
                    flex: auto;
                    margin: 5px; 
                }


    
            </style>
        </head>
    
        <body>
            <section class="wrap">
                <div id="calc-label" >My Calculator</div>
                <div class="calculator" tabindex="0" aria-labelledby="calc-label">
                    <section tabindex="0" class="result" id="result-id" aria-label="result area">
                        <p id="result-id" class="result-value">0</p>
                    </section>
                    <section class="buttons">
                            <div class="digits">
                                <button>1</button>
                                <button>2</button>
                                <button>3</button>
                                <button>4</button>
                                <button>5</button>
                                <button>6</button>
                                <button>7</button>
                                <button>8</button>
                                <button>9</button>
                                <button>0</button>
                            </div>
                            <div class="operators">
                                <button>+</button>
                                <button>-</button>
                                <button>*</button>
                                <button>/</button>
                                <button>=</button>
                            </div>
                    </section>

                </div>
            </section>
    
    
    
              <script  type="text/javascript">
                  var display;
                  var stack;
                  var shouldResetIfNumber;
                  $(document).ready(function() {
                        display = 0;
                        stack = new Stack();
                        stack.push(0);
                        shouldResetIfNumber = false;

                        $(".buttons").on("click", "button", function(){
                            var value = $(this).text();
                            input(value);
                            render();
                        });
                  });

                  var render = function() {
                    $(".result-value").text(display);
                  }

                class Stack {
                    constructor() {
                        this.stack = [];

                    }
                    
                    isEmpty() {
                        return this.stack.length === 0;
                    }

                    push(val) {
                        this.stack.push(val);
                    }

                    pop() {
                        if (this.isEmpty()) {
                            throw new Error("stack is empty");
                        }

                        return this.stack.pop();
                    }

                    peek() {
                        if (this.isEmpty()) {
                            throw new Error("stack is empty");
                        }
                        
                        return this.stack[this.stack.length - 1];
                    }
                }

                function input(char) {
                    if (isNum(char)) {
                        if (shouldResetIfNumber) {
                        stack.pop();
                        stack.push(parseInt(char));
                        shouldResetIfNumber = false;
                        } else if (isNum(stack.peek())) {//continousely input number
                        const n = stack.pop();
                        stack.push(n * 10 + parseInt(char));
                        } else {//new number, last input is operator
                        stack.push(parseInt(char));
                        }

                        display = stack.peek();

                    } else if (char !== '=') {//+-*/
                        shouldResetIfNumber = false;
                        display = reduce(stack);//should remove the tail operator;
                        stack.push(char);

                    } else {// =
                        display = reduce(stack);
                        shouldResetIfNumber = true;
                    }
                }

                function reduce(stack) {//remove trailing operator, reduce stack to single result
                    //cases: 0  |  0 +  |  0 + 1 | 
                    if (stack.isEmpty()) {
                        throw new Error("empty stack in reduce function");
                    }
                    
                    if (!isNum(stack.peek())) {
                        stack.pop();
                    }

                    const values = new Stack();
                    const operators = new Stack();
                    while (!stack.isEmpty()) {
                        values.push(stack.pop());
                        if (!stack.isEmpty()) {
                        operators.push(stack.pop());
                        }
                    }

                    //stack always start with number and should at least has 1 number, cannot start with operator
                    var result = values.pop();
                    if (!values.isEmpty()) {
                        var second = values.pop();
                        var operator = operators.pop();
                        result = calculate(result, second, operator);
                    }

                    stack.push(result);
                    return result;
                }

                function calculate(first, second, operator) {
                    var res = 0;
                    switch(operator) {
                        case "+":
                        res = first + second;
                        break;
                        case "-":
                        res = first - second;
                        break;
                        case "*":
                        res = first * second;
                        break;
                        case "/": 
                        res = first / second;
                        break;
                    }

                    return res;
                }
    
                function isNum(val) {
                        return !["+", "-", "*", "/", "="].includes(val);
                }
              </script>
        </body>
    </html>
    